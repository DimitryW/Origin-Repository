<!DOCTYPE html>

<html>

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../static/css/attraction.css" />
    <link rel="stylesheet" type="text/css" href="../static/css/booking.css" />
    <title>台北一日遊 預定行程</title>
</head>

<body>
    <div class="page-container">
        <div class="page-wrapper" id="page-wrapper">

            <div class="topnav-wrapper">
                <div id="backdrop"></div>
                <div class="topnav ">
                    <!-- <a class="nav-title" href="http://127.0.0.1:3000/">台北一日遊</a> -->
                    <a class="nav-title" href="http://3.230.236.135:3000/">台北一日遊</a>
                    <button class="nav-item1" id="nav-item1"><a id="nav-item1-a" style="text-decoration: none;">預定行程</a></button>
                    <button class="nav-item2" id="nav-item2">註冊/登入</button>
                </div>
            </div>
            <div id="booking-greeting"></div>
            <div id="nobooking">目前沒有任何待預訂的行程</div>
            <div class="booking-content" id="booking-content">
                <div class="booking-info">
                    <div class="booking-info-detail">
                        <img id="booking-info-img" src="">
                        <div id="itinerary" style="margin: 35px 0px 40px;">
                            <div>
                                <div style="font-weight: 700; color: #448899; margin: 0px 0px 20px 0px; display: inline-block;">台北一日遊 : <span id="attractName"></span></div>
                                <button id="delete-booking" onclick="deleteBooking();"></button>
                            </div>
                            <div style="margin-bottom: 10px; font-size: 16px; font-weight: 700;">日期 : <span id="book-date" style="margin-left:5px; font-weight: 400;"></span></div>
                            <div style="margin-bottom: 10px; font-size: 16px; font-weight: 700;">時間 : <span id="book-time" style="margin-left:5px; font-weight: 400;"></span></div>
                            <div style="margin-bottom: 10px; font-size: 16px; font-weight: 700;">費用 : <span id="book-charge" style="margin-left:5px; font-weight: 400;"></span></div>
                            <div style="margin-bottom: 10px; font-size: 16px; font-weight: 700;">地點 : <span id="book-address" style="margin-left:5px; font-weight: 400;"></span></div>
                        </div>
                    </div>
                </div>
                <div class="border-bottom1" style="border-bottom: 1px solid #E8E8E8;"></div>

                <div class="contact-info">
                    <div id="contact-err-msg" style="display: none; font-size: 19px; color: red; margin-top:30px ;">請輸入聯絡資訊</div>
                    <div style="font-size: 19px; font-weight: 700; margin: 44px 0px 24px 0px;">您的聯絡資訊</div>
                    <label for="contact-name">聯絡姓名：</label>
                    <input id="contact-name" name="contact-name" type="text" style="margin: 0px 0px 15px 8px;"><br>
                    <label for="contact-email">連絡信箱：</label>
                    <input id="contact-email" name="contact-email" type="email" style="margin: 0px 0px 15px 8px;"><br>
                    <label for="contact-number">手機號碼：</label>
                    <input id="contact-number" name="contact-number" type="tel" style="margin: 0px 0px 15px 8px;"><br>
                    <div style="margin: 0px 0px 45px 0px; font-weight: 700;">請保持手機暢通，準時到達，導覽人員將用手機與您聯繫，務必留下正確的聯絡方式。</div>
                </div>
                <div class="border-bottom2" style="border-bottom: 1px solid #E8E8E8;"></div>
                <form>
                    <div class="payment-info">
                        <div style="font-size: 19px; font-weight: 700; margin: 44px 0px 24px 0px;">信用卡付款資訊</div>
                        <div class="form-group card-number-group">
                            <label for="card-number" class="control-label">卡片號碼： </label>
                            <div name="card-number" class="form-control card-number"></div>
                        </div>
                        <div class="form-group expiration-date-group">
                            <label for="expiration-date" class="control-label">過期時間： </label>
                            <div name="expiration-date" class="form-control expiration-date" id="tappay-expiration-date"></div>
                        </div>
                        <div class="form-group cvc-group" style="margin-bottom: 43px;">
                            <label for="cvc" class="control-label">驗證密碼： </label>
                            <div name="" cvc "" class="form-control cvc"></div>
                        </div>
                        <div id="card-err-msg" style="display: none; font-size: 19px; color: red;">信用卡資料不正確，請重新輸入</div>
                        <div id="total-price">總價：新台幣 <span></span> 元</div><br>
                        <button id="confirm-button" type="submit" class="btn btn-default">確認訂購並付款</button>
                    </div>
                </form>

            </div>
        </div>
        <footer class="booking-footer" id="booking-footer">COPYRIGHT © 2021 台北一日遊</footer>
    </div>
    <script type="text/javascript" src="../static/script/member.js"></script>
    <script type="text/javascript" src="../static/script/booking.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://js.tappaysdk.com/tpdirect/v5.9.0"></script>
    <script>
        TPDirect.setupSDK(124007, 'app_X8jtqiiGoJSvEyhpZcog4DuLrqIfrmbbPHty7vQPS9gGdnqmmzeNtChLM5rA', 'sandbox')
        TPDirect.card.setup({
            fields: {
                number: {
                    element: '.form-control.card-number',
                    placeholder: '**** **** **** ****'
                },
                expirationDate: {
                    element: document.getElementById('tappay-expiration-date'),
                    placeholder: 'MM / YY'
                },
                ccv: {
                    element: $('.form-control.cvc')[0],
                    placeholder: 'CVV'
                }
            },
            styles: {
                'input': {
                    'color': 'gray'
                },
                'input': {
                    'font-size': '16px'

                },
                ':focus': {
                    'color': 'black'
                },
                '.valid': {
                    'color': 'green'
                },
                '.invalid': {
                    'color': 'red'
                },
                '@media screen and (max-width: 400px)': {
                    'input': {
                        'color': 'orange'
                    }
                }
            }
        })
        TPDirect.card.onUpdate(function(update) {
            if (update.canGetPrime) {
                $('button[type="submit"]').removeAttr('disabled')
            } else {
                $('button[type="submit"]').attr('disabled', true)
            }
        })
        $('form').on('submit', function(event) {
            event.preventDefault()
            let name = document.getElementById("contact-name").value;
            let email = document.getElementById("contact-email").value;
            let number = document.getElementById("contact-number").value;
            if (name === "" | email === "" | number === "") {
                document.getElementById("contact-err-msg").style.display = "block";
                return
            } else {
                document.getElementById("contact-err-msg").style.display = "none";
            }

            const tappayStatus = TPDirect.card.getTappayFieldsStatus()
            console.log(tappayStatus)

            // Check TPDirect.card.getTappayFieldsStatus().canGetPrime before TPDirect.card.getPrime
            if (tappayStatus.canGetPrime === false) {
                // alert('can not get prime')
                document.getElementById("card-err-msg").style.display = "block";
                return
            }

            // Get prime
            TPDirect.card.getPrime(function(result) {
                if (result.status !== 0) {
                    // alert('get prime error ' + result.msg)
                    document.getElementById("card-err-msg").style.display = "block";
                    return
                }
                document.getElementById("card-err-msg").style.display = "none";
                confirmBooking();
                send_order(result.card.prime);
            })
        })
    </script>
    <script type="text/javascript">
        window.onload = () => {
            loggedIn();
            checkBooking();
        };
    </script>

</body>

</html>